# Test pool hierarchies
# Creates following hierarchy of vlan ranges and vlans at the end

#               [0-4095]
#                   |
#          [0-2000]   [2001-4095]

query QueryRT {
    QueryResourceTypes {
        id
        Name
        PropertyTypes {
            Name
            Type
        }
    }
}
query QueryStrats {
    QueryAllocationStrategies {
        id
        Name
        Lang
    }
}

mutation TestAllocationStrat_vlanRange {
    TestAllocationStrategy(
        allocationStrategyId: 3,
        resourcePool: { ResourcePoolName: "[0-4095]", poolValues: { from: 0, to: 4095}},
        currentResources: [],
        userInput: {desiredSize: 101})
}

mutation TestAllocationStrat_vlanRange {
    TestAllocationStrategy(
        allocationStrategyId: 3,
        resourcePool: { ResourcePoolName: "[0-4095]", poolValues: { from: 0, to: 4095}},
        currentResources: [
            {Properties: {from: 0, to: 1000},
                Status: "claimed",
                UpdatedAt: "2020-08-30 11:38:48.0 +0200 CEST"
            },
        ],
        userInput: {desiredSize: 100})
}

mutation TestAllocationStrat_vlan {
    TestAllocationStrategy(
        allocationStrategyId: 4,
        resourcePool: { ResourcePoolName: "[0-4095]", poolValues: { from: 0, to: 4095}},
        currentResources: [],
        userInput: {})
}

# Root pool (resourceType: vlan_range)
mutation CreateRootPool_allocating {
    CreateAllocatingPool(input: {
        resourceTypeId: 25769803778,
        poolName: "rootpool[0-4095]",
        allocationStrategyId: 3,
        poolDealocationSafetyPeriod: 0,
        poolPropertyTypes: {
            from: "int",
            to: "int"
        },
        poolProperties: {from: 0, to: 4095},}
    ){
        pool {
            id
        }
    }
}

# Pool 0-2000 on level #2
mutation ClaimResourceFromRoot {
    ClaimResource(poolId:21474836480, userInput: {desiredSize: 2001}) {
        id
        Properties
    }
}

mutation CreateLevel2Pool1_allocating {
    CreateNestedAllocatingPool(input: {
        resourceTypeId: 25769803779,
        poolName: "firstpool[0-2000]",
        allocationStrategyId: 4,
        poolDealocationSafetyPeriod: 0,
        parentResourceId: 17179869184,
    }
    ){
        pool {
            id
        }
    }
}

# Pool 2001-4095 on level #2
mutation ClaimResourceFromRoot {
    ClaimResource(poolId:21474836480, userInput: {desiredSize:2095}) {
        id
        Properties
    }
}

mutation CreateLevel2Pool2_allocating {
    CreateNestedAllocatingPool(input: {
        resourceTypeId: 25769803779,
        poolName: "secondpool[2001-4095]",
        allocationStrategyId: 4,
        poolDealocationSafetyPeriod: 0,
        parentResourceId: 17179869185,
    }
    ){
        pool {
            id
        }
    }
}

# Pool 0-2000 on level #2
mutation ClaimResourceFromLevel2Pool1 {
    ClaimResource(poolId:21474836481, userInput: {}) {
        id
        Properties
    }
}

# Pool 2001-4095 on level #2
mutation ClaimResourceFromLevel2Pool2 {
    ClaimResource(poolId:21474836482, userInput: {}) {
        id
        Properties
    }
}