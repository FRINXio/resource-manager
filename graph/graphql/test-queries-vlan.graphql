# Test pool hierarchies
# Creates following hierarchy of vlan ranges and vlans at the end

#               [0-4095]
#                   |
#          [0-2000]   [2001-4095]

query QueryRT {
    QueryResourceTypes {
        ID
        Name
        PropertyTypes {
            Name
            Type
        }
    }
}
query QueryStrats {
    QueryAllocationStrategies {
        ID
        Name
        Lang
    }
}

mutation TestAllocationStrat_vlanRange {
    TestAllocationStrategy(
        allocationStrategyId: 3,
        resourcePool: { ResourcePoolName: "[0-4095]"},
        currentResources: [],
        userInput: {desiredSize: 101})
}

mutation TestAllocationStrat_vlanRange {
    TestAllocationStrategy(
        allocationStrategyId: 3,
        resourcePool: { ResourcePoolName: "[0-4095]"},
        currentResources: [
            {Properties: {from: 0, to: 1000},
                Status: "claimed",
                UpdatedAt: "2020-08-30 11:38:48.0 +0200 CEST"
            },
        ],
        userInput: {desiredSize: 100})
}

mutation TestAllocationStrat_vlan {
    TestAllocationStrategy(
        allocationStrategyId: 4,
        resourcePool: { ResourcePoolName: "[0-4095]"},
        currentResources: [],
        userInput: {})
}

# Root pool
mutation CreateRootPool_allocating {
    CreateAllocatingPool(input: {
        resourceTypeId: 21474836482,
        poolName: "[0-4095]",
        allocationStrategyId: 3,
        poolDealocationSafetyPeriod: 0}
    ){
        ID
    }
}

# Pool 0-2000 on level #2
mutation ClaimResourceFromRoot {
    ClaimResource(poolId:17179869184, userInput: {desiredSize: 2001}) {
        ID
        Properties
    }
}

mutation CreateLevel2Pool1_allocating {
    CreateNestedAllocatingPool(input: {
        resourceTypeId: 21474836483,
        poolName: "[0-2000]",
        allocationStrategyId: 4,
        poolDealocationSafetyPeriod: 0},
        parentResourceId: 12884901888
    ){
        ID
    }
}

# Pool 2001-4095 on level #2
mutation ClaimResourceFromRoot {
    ClaimResource(poolId:17179869184, userInput: {desiredSize:2095}) {
        ID
        Properties
    }
}

mutation CreateLevel2Pool2_allocating {
    CreateNestedAllocatingPool(input: {
        resourceTypeId: 21474836483,
        poolName: "[2001-4095]",
        allocationStrategyId: 4,
        poolDealocationSafetyPeriod: 0},
        parentResourceId: 12884901889
    ){
        ID
    }
}

# Pool 0-2000 on level #2
mutation ClaimResourceFromLevel2Pool1 {
    ClaimResource(poolId:17179869185, userInput: {}) {
        ID
        Properties
    }
}

# Pool 2001-4095 on level #2
mutation ClaimResourceFromLevel2Pool2 {
    ClaimResource(poolId:17179869186, userInput: {}) {
        ID
        Properties
    }
}