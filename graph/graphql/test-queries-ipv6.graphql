# Test pool hierarchies
# Creates following hierarchy of ipv6 prefixes and ipv6 addresses at the end

#                [dead::/120]
#                   |     |
#        [dead::/121]     [dead::80/121]

query QueryRT {
    QueryResourceTypes {
        ID
        Name
        PropertyTypes {
            Name
            Type
        }
    }
}
query QueryStrats {
    QueryAllocationStrategies {
        ID
        Name
        Lang
    }
}

mutation TestAllocationStrat_ipv6prefix {
    TestAllocationStrategy(
        allocationStrategyId: 5,
        resourcePool: { ResourcePoolName: "dead::/120"},
        currentResources: [],
        userInput: {desiredSize: 101})
}

mutation TestAllocationStrat_ipv6 {
    TestAllocationStrategy(
        allocationStrategyId: 6,
        resourcePool: { ResourcePoolName: "dead::/120"},
        currentResources: [],
        userInput: {subnet:true})
}

# Root pool
mutation CreateRootPool_allocating {
    CreateAllocatingPool(input: {
        resourceTypeId: 21474836484,
        poolName: "dead::/120",
        allocationStrategyId: 5,
        poolDealocationSafetyPeriod: 0}
    ){
        ID
    }
}

# Pool dead::/121 on level #2
mutation ClaimResourceFromRoot {
    ClaimResource(poolId:17179869184, userInput: {desiredSize: 128}) {
        ID
        Properties
    }
}

mutation CreateLevel2Pool1_allocating {
    CreateNestedAllocatingPool(input: {
        resourceTypeId: 21474836485,
        poolName: "dead::/121",
        allocationStrategyId: 6,
        poolDealocationSafetyPeriod: 0},
        parentResourceId: 12884901888
    ){
        ID
    }
}

# Pool dead::80/121 on level #2
mutation ClaimResourceFromRoot {
    ClaimResource(poolId:17179869184, userInput: {desiredSize:128}) {
        ID
        Properties
    }
}

mutation CreateLevel2Pool2_allocating {
    CreateNestedAllocatingPool(input: {
        resourceTypeId: 21474836485,
        poolName: "dead::80/121",
        allocationStrategyId: 6,
        poolDealocationSafetyPeriod: 0},
        parentResourceId: 12884901889
    ){
        ID
    }
}

# Get ips from pool dead::/121 on level #2
mutation ClaimResourceFromLevel2Pool1 {
    ClaimResource(poolId:17179869185, userInput: {}) {
        ID
        Properties
    }
}

# Get ips from pool dead::80/121 on level #2
mutation ClaimResourceFromLevel2Pool2 {
    ClaimResource(poolId:17179869186, userInput: {}) {
        ID
        Properties
    }
}