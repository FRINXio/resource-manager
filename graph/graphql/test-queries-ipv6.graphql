# Test pool hierarchies
# Creates following hierarchy of ipv6 prefixes and ipv6 addresses at the end

#                [dead::/120]
#                   |     |
#        [dead::/121]     [dead::80/121]

query QueryRT {
    QueryResourceTypes {
        id
        Name
        PropertyTypes {
            Name
            Type
        }
    }
}
query QueryStrats {
    QueryAllocationStrategies {
        id
        Name
        Lang
    }
}

mutation TestAllocationStrat_ipv6prefix {
    TestAllocationStrategy(
        allocationStrategyId: 5,
        resourcePool: { ResourcePoolName: "dead::/120", poolValues: { prefix: 120, address: "dead::"} },
        currentResources: [],
        userInput: {desiredSize: 101})
}

mutation TestAllocationStrat_ipv6 {
    TestAllocationStrategy(
        allocationStrategyId: 6,
        resourcePool: { ResourcePoolName: "dead::/120", poolValues: { prefix: 120, address: "dead::"}},
        currentResources: [],
        userInput: {subnet:true})
}

# Root pool
mutation CreateRootPool_allocating {
    CreateAllocatingPool(input: {
        resourceTypeId: 25769803780,
        poolName: "rootpooldead::/120",
        allocationStrategyId: 5,
        poolDealocationSafetyPeriod: 0,
        poolPropertyTypes: {
            address: "string",
            prefix: "int"
        },
        poolProperties: {address: "dead::", prefix: 120},}
    ){
        pool {
            id
        }
    }
}

# Pool dead::/121 on level #2
mutation ClaimResourceFromRoot {
    ClaimResource(poolId:21474836480, userInput: {desiredSize: 128}) {
        id
        Properties
    }
}

mutation CreateLevel2Pool1_allocating {
    CreateNestedAllocatingPool(input: {
        resourceTypeId: 25769803781,
        poolName: "level2pool1dead::/121",
        allocationStrategyId: 6,
        poolDealocationSafetyPeriod: 0,
        parentResourceId: 17179869184
    }
    ){
        pool {
            id
        }
    }
}

# Pool dead::80/121 on level #2
mutation ClaimResourceFromRoot {
    ClaimResource(poolId:21474836480, userInput: {desiredSize:128}) {
        id
        Properties
    }
}

mutation CreateLevel2Pool2_allocating {
    CreateNestedAllocatingPool(input: {
        resourceTypeId: 25769803781,
        poolName: "dead::80/121",
        allocationStrategyId: 6,
        poolDealocationSafetyPeriod: 0,
        parentResourceId: 17179869185
    }
    ){
        pool {
            id
        }
    }
}

# Get ips from pool dead::/121 on level #2
mutation ClaimResourceFromLevel2Pool1 {
    ClaimResource(poolId:21474836481, userInput: {}) {
        id
        Properties
    }
}

# Get ips from pool dead::80/121 on level #2
mutation ClaimResourceFromLevel2Pool2 {
    ClaimResource(poolId:21474836482, userInput: {}) {
        id
        Properties
    }
}